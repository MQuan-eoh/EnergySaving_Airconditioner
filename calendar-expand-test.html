<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendar Expand/Collapse Test</title>

    <!-- External Libraries -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="Assets/css/styles.css" />
    <link rel="stylesheet" href="Assets/css/electricity-bill.css" />

    <style>
      body {
        background: #0f172a;
        color: white;
        font-family: "Inter", sans-serif;
        padding: 2rem;
      }

      .test-container {
        max-width: 600px;
        margin: 0 auto;
      }

      .test-controls {
        margin-bottom: 2rem;
        text-align: center;
      }

      .test-btn {
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.3);
        color: #3b82f6;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        margin: 0 0.5rem;
        transition: all 0.3s ease;
      }

      .test-btn:hover {
        background: rgba(59, 130, 246, 0.2);
        transform: translateY(-1px);
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1 style="text-align: center; margin-bottom: 2rem">
        <i class="fas fa-calendar-alt"></i>
        Calendar Expand/Collapse Test
      </h1>

      <div class="test-controls">
        <button class="test-btn" onclick="openElectricityBillModal()">
          <i class="fas fa-chart-line"></i>
          Open Electricity Bill Modal
        </button>
        <button class="test-btn" onclick="testExpandToggle()">
          <i class="fas fa-expand-alt"></i>
          Test Toggle Function
        </button>
      </div>

      <!-- Test Calendar Section -->
      <div class="bill-calendar-section">
        <div class="calendar-header">
          <div class="calendar-title">
            <i class="fas fa-calendar-alt"></i>
            Test Calendar
            <button
              class="calendar-expand-toggle"
              id="test-calendar-expand-toggle"
              title="Thu gọn/Mở rộng lịch"
            >
              <i class="fas fa-compress-alt"></i>
            </button>
          </div>
        </div>

        <!-- Glass Calendar -->
        <div class="glass-calendar" id="test-glass-calendar">
          <!-- Compact View -->
          <div
            class="calendar-compact-view"
            id="test-calendar-compact-view"
            style="display: none"
          >
            <div class="compact-month-display">
              <div class="compact-month-info">
                <div class="compact-month-name" id="test-compact-month-name">
                  Tháng 9
                </div>
                <div class="compact-year-name" id="test-compact-year-name">
                  2025
                </div>
              </div>
              <div class="compact-status-indicators">
                <div class="compact-status-item" id="test-compact-has-data">
                  <i class="fas fa-check-circle"></i>
                  <span>Có dữ liệu</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Expanded View -->
          <div class="calendar-expanded-view" id="test-calendar-expanded-view">
            <div class="calendar-grid">
              <!-- Sample calendar grid -->
              <div class="calendar-day-header">CN</div>
              <div class="calendar-day-header">T2</div>
              <div class="calendar-day-header">T3</div>
              <div class="calendar-day-header">T4</div>
              <div class="calendar-day-header">T5</div>
              <div class="calendar-day-header">T6</div>
              <div class="calendar-day-header">T7</div>

              <div class="calendar-day">1</div>
              <div class="calendar-day">2</div>
              <div class="calendar-day">3</div>
              <div class="calendar-day">4</div>
              <div class="calendar-day">5</div>
              <div class="calendar-day">6</div>
              <div class="calendar-day">7</div>
              <div class="calendar-day">8</div>
              <div class="calendar-day">9</div>
              <div class="calendar-day">10</div>
              <div class="calendar-day">11</div>
              <div class="calendar-day">12</div>
              <div class="calendar-day">13</div>
              <div class="calendar-day">14</div>
              <div class="calendar-day">15</div>
              <div class="calendar-day">16</div>
              <div class="calendar-day">17</div>
              <div class="calendar-day">18</div>
              <div class="calendar-day">19</div>
              <div class="calendar-day">20</div>
              <div class="calendar-day">21</div>
              <div class="calendar-day today">22</div>
              <div class="calendar-day">23</div>
              <div class="calendar-day">24</div>
              <div class="calendar-day">25</div>
              <div class="calendar-day">26</div>
              <div class="calendar-day">27</div>
              <div class="calendar-day">28</div>
              <div class="calendar-day">29</div>
              <div class="calendar-day">30</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="js/electricity-bill-manager.js"></script>

    <script>
      // Test variables
      let testCalendarExpanded = true;
      const testExpandAnimationDuration = 300;

      // Initialize test functionality
      document.addEventListener("DOMContentLoaded", function () {
        // Add click listener to test toggle button
        document
          .getElementById("test-calendar-expand-toggle")
          .addEventListener("click", testToggleCalendarExpansion);

        console.log("Calendar expand/collapse test initialized");
      });

      function openElectricityBillModal() {
        if (typeof window.electricityBillManager === "undefined") {
          window.electricityBillManager = new ElectricityBillManager();
          window.electricityBillManager.init();
        }
        window.electricityBillManager.show();
      }

      function testToggleCalendarExpansion() {
        testCalendarExpanded = !testCalendarExpanded;
        testUpdateCalendarDisplayMode();
        console.log(
          `Test Calendar ${testCalendarExpanded ? "expanded" : "collapsed"}`
        );
      }

      function testUpdateCalendarDisplayMode() {
        const compactView = document.getElementById(
          "test-calendar-compact-view"
        );
        const expandedView = document.getElementById(
          "test-calendar-expanded-view"
        );
        const toggleButton = document.getElementById(
          "test-calendar-expand-toggle"
        );
        const toggleIcon = toggleButton?.querySelector("i");

        if (!compactView || !expandedView || !toggleButton || !toggleIcon) {
          console.warn("Test calendar view elements not found");
          return;
        }

        if (testCalendarExpanded) {
          // Show expanded view (full calendar grid)
          testAnimateViewTransition(compactView, expandedView, false);
          toggleIcon.className = "fas fa-compress-alt";
          toggleButton.title = "Thu gọn lịch";
        } else {
          // Show compact view (month/year only)
          testAnimateViewTransition(expandedView, compactView, true);
          toggleIcon.className = "fas fa-expand-alt";
          toggleButton.title = "Mở rộng lịch";
        }
      }

      function testAnimateViewTransition(
        hideElement,
        showElement,
        isCompactMode
      ) {
        // Add transition classes
        hideElement.style.transition = `opacity ${testExpandAnimationDuration}ms ease-in-out, transform ${testExpandAnimationDuration}ms ease-in-out`;
        showElement.style.transition = `opacity ${testExpandAnimationDuration}ms ease-in-out, transform ${testExpandAnimationDuration}ms ease-in-out`;

        // Start hide animation
        hideElement.style.opacity = "0";
        hideElement.style.transform = isCompactMode
          ? "scale(1.1)"
          : "scale(0.95)";

        setTimeout(() => {
          // Hide the old view and show the new one
          hideElement.style.display = "none";
          showElement.style.display = "block";

          // Reset transform for show animation
          showElement.style.opacity = "0";
          showElement.style.transform = isCompactMode
            ? "scale(0.95)"
            : "scale(1.1)";

          // Trigger show animation
          requestAnimationFrame(() => {
            showElement.style.opacity = "1";
            showElement.style.transform = "scale(1)";
          });

          // Clean up transition styles after animation
          setTimeout(() => {
            hideElement.style.transition = "";
            showElement.style.transition = "";
            hideElement.style.transform = "";
            showElement.style.transform = "";
          }, testExpandAnimationDuration);
        }, testExpandAnimationDuration / 2);
      }

      function testExpandToggle() {
        testToggleCalendarExpansion();
      }
    </script>
  </body>
</html>
